---
title: "wrangling using plant phenology data"
author: "An Bui"
date: "4/9/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(here)
library(lubridate)
```

```{r}
site_phenometrics_data <- read_csv(here("data","site_phenometrics_data.csv"))
```

```{r filter California observations only}
ca_pheno <- site_phenometrics_data %>%
  filter(State == "CA")
```

```{r select columns that you want}
select_columns <- ca_pheno %>% 
  select(1:4, Genus, Species, Common_Name, Phenophase_Description, Mean_First_Yes_Year, Mean_First_Yes_DOY)
```

```{r take out all rows with placeholders in year and DOY}
convert_NA <- select_columns %>% 
  filter(Mean_First_Yes_Year != -9999 &
           Mean_First_Yes_DOY != -9999)
```

```{r getting date from day of year}
# might be something to to at the beginning, because date wrangling is not really in the scope of this whole thing
convert_NA$origin <- as.Date(paste0(convert_NA$Mean_First_Yes_Year, "-01-01", tz = "UTC"))
convert_NA$newdate <- as.Date(dates$Mean_First_Yes_DOY, origin = convert_NA$origin, tz = "UTC")
```

```{r getting date info from newdate column and getting rid of other date columns}
new_dates <- convert_NA %>% 
  mutate(year = year(newdate),
         month = month(newdate)) %>% 
  select(-(9:12))
```

```{r make a plot of Joshua tree phenology}
#### wrangle the data ####
# make a new df where the genus and species columns are together
merge_sp <- new_dates %>% 
  unite("Genus_Species", Genus, Species)

# filter data frame to only include Joshua trees
jt <- merge_sp %>% 
  filter(Genus_Species == "Yucca_brevifolia")

# set levels for flowering descriptions
levels(jt$Phenophase_Description) <- c("Flowers or flower buds", "Open flowers", "Pollen release (flowers)")

# summarize the number of times each observation occurs
jt_summary <- jt %>% 
  group_by(month, Phenophase_Description) %>% 
  tally()

#### plot in ggplot ####
ggplot(jt_summary, aes(x = month, 
                       y = n, 
                       fill = Phenophase_Description)) +
  geom_col(position = "dodge")
```


